<?xml version="1.0" ?>
<sdf version="1.6">
    <model name='boat'>
        <enable_wind>true</enable_wind>
        <plugin filename="WaterCurrent" name="water_current::WaterCurrent">
            <link_name>boat_body</link_name>
        </plugin>


        <link name='boat_body'>
            <inertial>
                <pose>0.999251 0.000005 -1.223034 0 0 0</pose>
                <mass>1610</mass>
                <inertia>
                    <ixx>1.325642e+2</ixx>
                    <ixy>-0.000002e+2</ixy>
                    <ixz>0.121894e+2</ixz>
                    <iyy>4.792929e+2</iyy>
                    <iyz>0.000095e+2</iyz>
                    <izz>5.052444e+2</izz>
                </inertia>

<!--                | 1.325642 -0.000002 0.121894 |-->
<!--                | -0.000002 4.792929 0.000095 |-->
<!--                | 0.121894 0.000095 5.052444 |-->
            </inertial>

            <visual name='boat_visual'>
                <geometry>
                    <mesh>
                        <uri>model://boat/meshes/boat3.dae</uri>
                    </mesh>
                </geometry>
                <material>
                    <ambient>0.1 0.1 0.1 1</ambient>
                    <diffuse>0.1 0.1 0.2 1</diffuse>
                    <specular>0 0 0 0</specular>
                    <emissive>0 0 0 1</emissive>
                </material>
            </visual>
            <collision name='boat_collision'>
                <geometry>
                    <mesh>
                        <uri>model://boat/meshes/boat3.stl</uri>
                    </mesh>
                </geometry>
            </collision>
        </link>

        <link name="engine_link">
            <pose>0 0 -1 0 0 0</pose>
            <visual name="visual">
                <geometry>
                    <mesh>
                        <uri>model://wam-v/meshes/engine.dae</uri>
                    </mesh>
                </geometry>
            </visual>
            <collision name="engine_vertical_axis_collision">
                <pose>-0.16 0 -0.215 0 0 0</pose>
                <geometry>
                    <box>
                        <size>0.2 0.1 0.83</size>
                    </box>
                </geometry>
            </collision>
            <collision name="engine_rear_end_collision">
                <pose>-0.34 0 0.12 0 0 0</pose>
                <geometry>
                    <box>
                        <size>0.12 0.15 0.12</size>
                    </box>
                </geometry>
            </collision>
            <inertial>
                <mass>15</mass>
                <inertia>
                    <ixx>0.88924</ixx>
                    <ixy>0</ixy>
                    <iyy>0.911125</iyy>
                    <iyz>0</iyz>
                    <izz>0.078125</izz>
                </inertia>
            </inertial>
        </link>
        <joint name="engine_joint" type="revolute">
            <parent>boat_body</parent>
            <child>engine_link</child>
            <axis>
                <xyz>0 0 1</xyz>
                <limit>
                    <lower>0</lower>
                    <upper>0</upper>
                </limit>
                <dynamics>
                    <damping>0.05</damping>
                </dynamics>
            </axis>
        </joint>

        <link name="propeller_link">
            <pose relative_to="propeller_joint">0 0 0 0 0 0</pose>
            <visual name="visual">
                <geometry>
                    <mesh>
                        <uri>model://wam-v/meshes/propeller.dae</uri>
                    </mesh>
                </geometry>
            </visual>
            <collision name="collision">
                <pose>-0.11 0 0 0 1.570796 0</pose>
                <geometry>
                    <cylinder>
                        <length>0.08</length>
                        <radius>0.24</radius>
                    </cylinder>
                </geometry>
            </collision>
            <inertial>
                <mass>0.5</mass>
                <inertia>
                    <ixx>0.008545</ixx>
                    <ixy>0</ixy>
                    <iyy>0.008545</iyy>
                    <iyz>0</iyz>
                    <izz>0.0144</izz>
                </inertia>
            </inertial>
        </link>
        <joint name="propeller_joint" type="revolute">
            <pose relative_to="engine_link">-0.278156 0 -0.509371 0 0 0</pose>
            <parent>engine_link</parent>
            <child>propeller_link</child>
            <axis>
                <xyz>1 0 0</xyz>
                <dynamics>
                    <damping>0.01</damping>
                </dynamics>
                <limit>
                    <lower>-1e+16</lower>
                    <upper>1e+16</upper>
                </limit>
            </axis>
        </joint>

        <plugin filename="gz-sim-joint-state-publisher-system"
                name="gz::sim::systems::JointStatePublisher">
        </plugin>
        <plugin filename="gz-sim-apply-joint-force-system"
                name="gz::sim::systems::ApplyJointForce">
            <joint_name>engine_joint</joint_name>
        </plugin>


        <!-- Thruster plugins -->
        <plugin
                filename="gz-sim-thruster-system"
                name="gz::sim::systems::Thruster">
            <namespace>boat</namespace>
            <joint_name>propeller_joint</joint_name>
            <use_angvel_cmd>0</use_angvel_cmd>
            <fluid_density>1000</fluid_density>
            <propeller_diameter>0.48</propeller_diameter>
            <thrust_coefficient>0.01</thrust_coefficient>
            <velocity_control>1</velocity_control>
            <!-- <p_gain>1.0</p_gain>
            <i_gain>0.0</i_gain>
            <d_gain>0.0</d_gain> -->
            <max_thrust_cmd>10000.0</max_thrust_cmd>
            <min_thrust_cmd>-10000.0</min_thrust_cmd>
        </plugin>


        <!-- Hydrodynamics plugin -->
        <plugin
                filename="gz-waves1-hydrodynamics-system"
                name="gz::sim::systems::Hydrodynamics">

            <enable>boat::boat_body</enable>

            <hydrodynamics>
                <damping_on>1</damping_on>
                <viscous_drag_on>1</viscous_drag_on>
                <pressure_drag_on>1</pressure_drag_on>

                <!-- Linear and Angular Damping -->
                <cDampL1>1.0E-6</cDampL1>
                <cDampL2>1.0E-6</cDampL2>
                <cDampR1>1.0E-6</cDampR1>
                <cDampR2>1.0E-6</cDampR2>

                <!-- 'Pressure' Drag -->
                <cPDrag1>1.0E+2</cPDrag1>
                <cPDrag2>1.0E+2</cPDrag2>
                <fPDrag>0.4</fPDrag>
                <cSDrag1>1.0E+2</cSDrag1>
                <cSDrag2>1.0E+2</cSDrag2>
                <fSDrag>0.4</fSDrag>
                <vRDrag>1.0</vRDrag>
            </hydrodynamics>
        </plugin>

        <!-- ArduPilot plugin -->
        <plugin name="ArduPilotPlugin" filename="ArduPilotPlugin">
            <fdm_addr>127.0.0.1</fdm_addr>
            <fdm_port_in>9002</fdm_port_in>
            <connectionTimeoutMaxCount>5</connectionTimeoutMaxCount>
            <lock_step>1</lock_step>
            <modelXYZToAirplaneXForwardZDown>0 0 0 3.141593 0 0</modelXYZToAirplaneXForwardZDown>
            <gazeboXYZToNED>0 0 0 3.141593 0 1.57079632</gazeboXYZToNED>
<!--            <imuName>imu_sensor</imuName>-->

            <!--
              SERVO1_FUNCTION 26 (GroundSteering)
            -->
            <control channel="0">
                <jointName>engine_joint</jointName>
                <useForce>1</useForce>
                <multiplier>3.1415926</multiplier>
                <offset>-0.5</offset>
                <servo_min>1000</servo_min>
                <servo_max>2000</servo_max>
                <type>POSITION</type>
                <p_gain>500.0</p_gain>
                <i_gain>0</i_gain>
                <d_gain>10</d_gain>
                <i_max>-1</i_max>
                <i_min>0</i_min>
                <cmd_max>5000.0</cmd_max>
                <cmd_min>-5000.0</cmd_min>
            </control>

            <!--
              SERVO3_FUNCTION 70 (Throttle)

              max thrust: +/- 1500 N (larger than VRX settings of +250 N / -100 N)

            -->
            <control channel="2">
                <jointName>propeller_joint</jointName>
                <useForce>1</useForce>
                <multiplier>3000</multiplier>
                <offset>-0.5</offset>
                <servo_min>1000</servo_min>
                <servo_max>10000</servo_max>
                <type>COMMAND</type>
                <cmd_topic>/model/boat/joint/propeller_joint/cmd_thrust</cmd_topic>
            </control>
        </plugin>

    </model>
</sdf>